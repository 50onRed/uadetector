<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--
 | Generated by Apache Maven Doxia at Oct 8, 2014
 | Rendered using Apache Maven Fluido Skin 1.2.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
		Usage of UADetector</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido.min.js"></script>

          
                
        <?xml version="1.0" encoding="UTF-8"?>
<meta content="user-agent detection, detect user-agents, detect robots, detect mobile browser, mobile browser detection, mobile phone detection, java" name="keywords"/>
          
      <meta name="author" content="André Rouél" />
    <meta name="Date-Revision-yyyymmdd" content="20141008" />
    <meta http-equiv="Content-Language" content="en" />
    
          <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-31080371-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/before/uadetector">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 100;"
        src="https://a248.e.akamai.net/assets.github.com/img/7afbc8b248c68eb468279e8c17986ad46549fb71/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="./" id="bannerLeft" title="Logo of UADetector">
                                                                                                <img src="images/dragonfly.png"  alt="Logo of UADetector"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="./" title="UADetector">UADetector</a>
        <li class="divider ">/</li>
      </li>
    <li class="">
		Usage of UADetector</li>
      
                
                    
                  <li id="publishDate" class="pull-right">Last Published: 2014-10-08</li> <li class="divider pull-right">|</li>
              <li id="projectVersion" class="pull-right">Version: 2014.10-SNAPSHOT</li>
            
                  </ul>
      </div>

            <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                                    <h3>Overview</h3>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="About">About</a>
            </li>
                  <li class="none">
            <strong>Usage</strong>
          </li>
                  <li class="none">
                          <a href="download.html" title="Download">Download</a>
            </li>
                  <li class="none">
                          <a href="license.html" title="License">License</a>
            </li>
                  <li class="none">
                          <a href="team-list.html" title="Team">Team</a>
            </li>
                  <li class="none">
                          <a href="third-party-licenses.html" title="Third Party Licenses">Third Party Licenses</a>
            </li>
          </ul>
                        <h3>Examples</h3>
                  <ul>
                  <li class="none">
                          <a href="quickstart.html" title="Quick Start with Maven">Quick Start with Maven</a>
            </li>
                  <li class="none">
                          <a href="usage.html#usage_in_a_servlet" title="Usage in a Servlet">Usage in a Servlet</a>
            </li>
                  <li class="none">
                          <a href="usage.html#improve_performance" title="Improve Performance by Caching">Improve Performance by Caching</a>
            </li>
                  <li class="none">
                          <a href="usage.html#undeploy" title="Redeploying / Undeploying UADetector">Redeploying / Undeploying UADetector</a>
            </li>
                  <li class="none">
                          <a href="building.html" title="Building UADetector">Building UADetector</a>
            </li>
          </ul>
                        <h3>Modules</h3>
                  <ul>
                  <li class="none">
                          <a href="modules/uadetector-core/index.html" title="Core">Core</a>
            </li>
                  <li class="none">
                          <a href="modules/uadetector-resources/index.html" title="Resources">Resources</a>
            </li>
          </ul>
                        <h3>Project Documentation</h3>
                  <ul>
                  <li class="none">
                          <a href="dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a>
            </li>
                  <li class="none">
                          <a href="dependency-management.html" title="Dependency Management">Dependency Management</a>
            </li>
                  <li class="none">
                          <a href="issue-tracking.html" title="Issue Tracking">Issue Tracking</a>
            </li>
                  <li class="none">
                          <a href="known-issues.html" title="Known Issues">Known Issues</a>
            </li>
                  <li class="none">
                          <a href="plugin-management.html" title="Plugin Management">Plugin Management</a>
            </li>
                  <li class="none">
                          <a href="plugins.html" title="Plugins">Plugins</a>
            </li>
                  <li class="none">
                          <a href="project-summary.html" title="Summary">Summary</a>
            </li>
                  <li class="none">
                          <a href="source-repository.html" title="Source Repository">Source Repository</a>
            </li>
          </ul>
                  <ul>
                  <li class="none">
                          <a href="http://sourceforge.net/projects/uadetector/" class="externalLink" title="Project page at SourceForge">Project page at SourceForge</a>
            </li>
          </ul>
                      
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="$sitesearchValue" name="sitesearch" type="hidden"/>
  <input class="span2 search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="http://uadetector.sourceforge.net/" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                                                                                                                   <a href="http://www.sourceforge.net/" title="Hosted by SourceForge" class="poweredBy">
        <img class="poweredBy"  alt="Hosted by SourceForge" src="http://sourceforge.net/sflogo.php?group_id=16035&type=1"    />
      </a>
                                                                                                    <a href="http://user-agent-string.info/" title="Analyze UA" class="poweredBy">
        <img class="poweredBy"  alt="Analyze UA" src="http://user-agent-string.info/pub/img/logo.png"    />
      </a>
                      </div>
          </div>
        </div>
        
        <div id="bodyColumn"  class="span9" >
                                  
            
	
		<div class="section"><h2>Usage<a name="Usage"></a></h2>
			<div class="section"><h3>Requirements<a name="Requirements"></a></h3>
			<p>
				This library depends on Simple Logging Facade for Java (also known as SLF4J) to allow our end users to plug in
				whatever logging framework he wants at deployment time. Additionally it depends on
				<a class="externalLink" href="http://qualitycheck.sourceforge.net/">Quality-Check</a>
				to do technical runtime checks easily and
				<i>JSR-305 Annotations</i>
				to document possible states about methods, fields and arguments for Software Defect Detection.
			</p>
			<p>This means that if you use UADetector library, all compile and runtime dependencies must exists in your
				classpath. You can get detailed informations about the required dependencies for each module here:
			</p>
			<ul>
				<li>
					<a href="modules/uadetector-core/dependencies.html">
						Dependencies of
						<i>Core</i>
						module
					</a>
				</li>
				<li>
					<a href="modules/uadetector-resources/dependencies.html">
						Dependencies of
						<i>Resources</i>
						module
					</a>
				</li>
			</ul>
			<a name="usage_in_a_servlet"></a>
			</div><div class="section"><h3>Usage in a simple Servlet<a name="Usage_in_a_simple_Servlet"></a></h3>
			<p>
				To use this library you must add them with all their sub-dependencies to your classpath. With Apache Maven you can
				start with
				<a href="quickstart.html">this guide</a>
				quickly.
			</p>
			<p>Then you should have access to the classes of the library. For example, you might want to make a Servlet as the
				following to detect an requesting client.
			</p>
			<div class="source"><pre class="prettyprint linenums">package net.sf.uadetector.example;

import java.io.IOException;
import javax.servlet.*;
import net.sf.uadetector.service.UADetectorServiceFactory;
import net.sf.uadetector.UserAgent;
import net.sf.uadetector.UserAgentStringParser;

public class HelloServlet extends HttpServlet {

	private static final long serialVersionUID = 1L;

	protected void doGet(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {

		response.setContentType(&quot;text/html&quot;);
		response.setStatus(HttpServletResponse.SC_OK);

		PrintWriter out = response.getWriter();

		// Get an UserAgentStringParser and analyze the requesting client
		UserAgentStringParser parser = UADetectorServiceFactory.getResourceModuleParser();
		ReadableUserAgent agent = parser.parse(request.getHeader(&quot;User-Agent&quot;));

		out.append(&quot;You're a &lt;em&gt;&quot;);
		out.append(agent.getName());
		out.append(&quot;&lt;/em&gt; on &lt;em&gt;&quot;);
		out.append(agent.getOperatingSystem().getName());
		out.append(&quot;&lt;/em&gt;!&quot;);
	}

}</pre></div>
			<a name="improve_performance"></a>
			</div><div class="section"><h3>Improve Performance by Caching<a name="Improve_Performance_by_Caching"></a></h3>
			<p>
				Since the parsing of user agent strings is very processing costly, it's recommended to build a cache on top of the
				parser. You can use a simple
				<tt>HashMap</tt>
				or
				<i>Guava's</i>
				<tt>CacheBuilder</tt>
				for example.
			</p>
			<div class="source"><pre class="prettyprint linenums">package to.noc.uadetector.example;

import java.util.concurrent.TimeUnit;
import net.sf.uadetector.ReadableUserAgent;
import net.sf.uadetector.UserAgentStringParser;
import net.sf.uadetector.service.UADetectorServiceFactory;
import com.google.common.cache.Cache;
import com.google.common.cache.CacheBuilder;

public final class CachedUserAgentStringParser implements UserAgentStringParser {

	private final UserAgentStringParser parser = UADetectorServiceFactory
							.getCachingAndUpdatingParser();
	private final Cache&lt;String, ReadableUserAgent&gt; cache = CacheBuilder.newBuilder()
							.maximumSize(100)
							.expireAfterWrite(2, TimeUnit.HOURS)
							.build();

	@Override
	public String getDataVersion() {
		return parser.getDataVersion();
	}

	@Override
	public ReadableUserAgent parse(final String userAgentString) {
		ReadableUserAgent result = cache.getIfPresent(userAgentString);
		if (result == null) {
			result = parser.parse(userAgentString);
			cache.put(userAgentString, result);
		}
		return result;
	}

	@Override
	public void shutdown() {
		parser.shutdown();
	}

}</pre></div>
			<a name="undeploy"></a>
			</div><div class="section"><h3>Redeploying / Undeploying UADetector<a name="Redeploying__Undeploying_UADetector"></a></h3>
			<p>
				In environments where the
				<abbr title="Java Virtual Machine">JVM</abbr>
				will never shut down while reinstalling UADetector, it is necessary to manually shutdown running
				threads.
				Therefore we provide since
				<tt>uadetector-core-0.9.6</tt>
				<a href="./modules/uadetector-core/apidocs/net/sf/uadetector/UserAgentStringParser.html#shutdown">UserAgentStringParser#shutdown()</a>
				and
				<a href="./modules/uadetector-core/apidocs/net/sf/uadetector/internal/util/ExecutorServices.html#shutdownAll">ExecutorServices#shutdownAll()</a>
				to stop running executors and schedulers if necessary.
			</p>
			<p>
				For example, during destroying a servlet you can clean up used parsers within your web application like this.
			</p>
			<div class="source"><pre class="prettyprint linenums">public class HelloServlet extends HttpServlet {

	@Override
	public void destroy() {
		// undeploy used parser cleanly
		UADetectorServiceFactory.getOnlineUpdatingParser().shutdown();
	}

	@Override
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// working with an updating UserAgentStringParser
		UserAgentStringParser parser = UADetectorServiceFactory.getOnlineUpdatingParser();

		// ... do something ...
	}

}
</pre></div>
			</div><div class="section"><h3>Demo<a name="Demo"></a></h3>
			<p>
				You can also find a hello world demo in the Source Content Management System (SCM) under
				<a class="externalLink" href="https://github.com/before/uadetector/tree/master/examples/helloworld" target="_blank">examples/helloworld</a>.
			</p>
		</div></div>
	

                  </div>
            </div>
      
    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span16">Copyright &copy;                   2011-2014.
          All Rights Reserved.      
                    
      </div>

        
        
          
    
    
                
    <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="http://www.ohloh.net/p/597219/widgets/project_users.js"></script>
    </div>
        </div>
    </footer>
  </body>
</html>
